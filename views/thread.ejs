<% if (typeof assetpath === 'undefined') { assetpath = '' } %>
<!doctype html>
<html lang="en">
<head>
	<% include partials/head %>
</head>
<body>
	<% include partials/header %>

	<div class="container">
		<div>
	    <h2><%= post.title %></h2>
	    <p><%= post.text %></p>
			<p><%= post.date %></p>

			<div class="d-flex flex-row justify-content-start align-items-center">
		    <div><a id="name-<%= post.id %>" href="/userpage/<%= post.user_id %>" style="height: 1rem;"></a></div>
				<% if (user.image==null){ %>
					<img src="<%= assetpath %>assets/images/kappa.png" class="ml-1 bg-secondary rounded-circle" style="height: 30px; width: 30px;" alt="Default"/>
				<%} else { %>
					<img src="<%= user.image %>" class="bg-secondary rounded-circle" style="height: 30px; width: 30px;" alt="User's Pic"/>
				<% } %>
		  </div>

			<form id="starForm" action="javascript:void(0);">
				<input name="post_id" type="hidden" value="<%= post.id %>"/>

				<% if (post.favorite){ %>
					<button class="btn btn-warning" onclick="postForm('#starForm', '/favorite/', '/post/<%= post.id %>')">
						<i class="fas fa-star"></i>
					</button>
				<% } else{ %>
					<button class="btn btn-secondary" onclick="postForm('#starForm', '/favorite/', '/post/<%= post.id %>')">
						<i class="far fa-star"></i>
					</button>
				<% } %>
			</form>

			<% if (user.admin && !post.locked){ %>
				<form id="lockForm" action="javascript:void(0);">
					<input name="post_id" type="hidden" value="<%= post.id %>"/>
					<button class="btn btn-dark" onclick="postForm('#lockForm', '/post/lock', '/post/<%= post.id %>')">
						<i class="fas fa-lock"></i>
					</button>
				</form>
			<% } %>
	  </div>

		<h4>Comments</h4>
		<ul>
			<% if (typeof sub_posts !== 'undefined') { %>
				<% sub_posts.forEach(function(spost) { %>
					<li>
						<h2><%= spost.title %></h2>
				    <p><%= spost.text %></p>
						<p><%= spost.date %></p>

						<div class="d-flex flex-row justify-content-start align-items-center">
					    <div><a id="name-<%= spost.id %>" href="/userpage/<%= spost.user_id %>" style="height: 1rem;"></a></div>
							<% if (user.image==null){ %>
								<img src="<%= assetpath %>assets/images/kappa.png" class="ml-1 bg-secondary rounded-circle" style="height: 30px; width: 30px;" alt="Default"/>
							<%} else { %>
								<img src="<%= user.image %>" class="bg-secondary rounded-circle" style="height: 30px; width: 30px;" alt="User's Pic"/>
							<% } %>
					  </div>
					</li>
				<% }); %>
			<% }Â %>
		</ul>

		<% if (!post.locked){ %>
			<h4>Comment</h4>
			<form id="commentForm" action="javascript:void(0);">
				<input name="title" type="hidden" value="Re: <%= post.title %>"/>
				<input name="parent_id" type="hidden" value="<%= post.id %>"/>

		    <div class="form-group">
		      <textarea class="form-control"
		                name="text"
		                rows="3"
		                placeholder="E.g. I loved your post, brah"
										required></textarea>
		    </div>

		    <button class="btn-light" onclick="postForm('#commentForm', '/post/new', '/post/<%= post.id %>')">Add comment</button>
		  </form>
		<% } %>
	</div>

  <div>
		<div class="p-3 mb-2 bg-primary text-white">
    <h2><%= post.title %></h2>
	</div>
		<div class="container" colour>
    <p><%= post.text %></p>
		</div>
  </div>

</body>
<script>

function getUserInfo(id, name_id, image_id){
	get('/user/' + id, [], function(data){
		$('#' + name_id).html(data.user.name);
		$('#' + image_id).attr('src', data.user.image);
	}, function(error){
		console.log(error);
	});
}

getUserInfo("<%= post.user_id %>", "name-<%= post.id %>", "image-<%= post.id %>");

<% if (typeof sub_posts !== 'undefined') { %>
	<% sub_posts.forEach(function(spost) { %>
		getUserInfo("<%= spost.user_id %>", "name-<%= spost.id %>", "image-<%= spost.id %>");
	<% }); %>
<% } %>


</script>
</html>
